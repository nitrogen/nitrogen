#!/usr/bin/env escript
%% -*- mode: erlang -*-
%%! -sname mergeconfigs

main([In, Out]) ->
  C = read(filelib:wildcard(In ++ "/*.config")),
  file:write_file(Out, io_lib:format("~s~p.", [warning(In), lists:flatten(C)])).

read(Files) -> read(Files, []).
               
read([], Blocks) -> Blocks;
read([Filename | Rest], Blocks) ->
  {ok, [Block]} = file:consult(Filename),
  read(Rest, [Block | Blocks]).
  
warning(In) -> 
  io_lib:format(
    "%% File is generated by bin/merge-configs from sources in ~s.~n"
    "%% Do not edit by hand!~n~n", [In]).
