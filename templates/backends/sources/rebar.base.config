% vim:ts=4 sw=4 et ft=erlang

%% These provider_hooks (appup, tar, etc) allow live upgrading the release
{provider_hooks, [
    {pre, [{tar, {appup, tar}}]},
    {post, [
        {compile, {appup, compile}},
        {clean, {appup, clean}}
    ]}
]}.

{cover_enabled, true}.

{erl_opts, [
    %% We want debug_info so that the behaviors are loaded
    debug_info
]}.

{pre_hooks, [
    %% On *nix:
    %%   1) Process any nitrogen plugins
    %%   2) establish or link the static directory (from the nitrogen_core files)
    %%   3) Combine all the etc/*.config files together into one big config file
    %%      that is processed and loaded in the relx rules below
    %%      (the file is named autogenerated.config.all)
    {"linux|bsd|darwin|solaris",compile,"./do-plugins.escript"},
    {"linux|bsd|darwin|solaris",compile,"./copy_static.escript link"},
    {"linux|bsd|darwin|solaris",compile,"etc/assemble_config.escript etc etc/autogenerated.config.all"},
    {"win32", compile, "pre_compile.cmd"}
]}.

{relx, [{release, {{{name}}, git}, [
            sasl,
            %% BACKEND_LOADERS,
            {sync, load},
            {{name}}
        ]},
        {sys_config, "etc/autogenerated.config.all"},
        {vm_args, "etc/vm.args"},
        {dev_mode, true},
        {mode, dev},
        {include_erts, {{include_erts}}},
        %% Nitrogen requires debug_info or all behaviors will fail.
        {debug_info, keep}, 
        {extended_start_script, true},
        {overlay, [
            {copy, "priv", "priv"}
%            {copy, "site", "site"}
        ]}
       ]
}.

%% This rule is for backwards compatibility with Nitrogen 2. By uncommenting
%% this rule, it will add some redundant class names to the HTML generated
%% element. For example, this will ensure that a #textbox{} element will be
%% produce HTML with a 'textbox' class.
%% If you change this value, you'll need to run a `make clean`
% {overrides, [
%     {add, nitrogen_core, [
%         {erl_opts, [
%             {d, 'DO_ELEMENT_CLASSES'}
%         ]}
%     ]}
% ]}.

{shell, [
%     {apps, nitrogen},
%     {vm_args, "etc/vm.args"}
]}.

{plugins, [
    rebar3_run,
    %rebar3_appup_plugin
    %% this 'develop' version is needed until the newer version is published
    {rebar3_appup_plugin, {git, "https://github.com/lrascao/rebar3_appup_plugin", {branch, develop}}}
]}.

{deps, [
    %% BACKEND_DEPS,
    {nitrogen_core, {git, "https://github.com/nitrogen/nitrogen_core", {branch, master}}},
    sync
]}.
